local espEnabled = false
local espConnection

Visuals:AddToggle({
    Name = "Show Chest",
    Default = false,
    Callback = function(Value)
        if Value then
            -- Enable ESP
            espEnabled = true
            
            -- Configuration
            local SEARCH_SIZE = Vector3.new(3.5, 0.5, 2.5)
            local MAX_DISTANCE = 125
            local REFRESH_RATE = 25
            local LABEL_TEXT = "CHEST"
            local BATCH_SIZE = 50

            -- Function to create or update a label
            local function createLabel(part)
                if not part:FindFirstChild("LocationLabel") then
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "LocationLabel"
                    billboard.Size = UDim2.new(0, 200, 0, 50)
                    billboard.StudsOffset = Vector3.new(0, 2, 0)
                    billboard.AlwaysOnTop = true
                    billboard.MaxDistance = MAX_DISTANCE
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.BackgroundTransparency = 1
                    textLabel.TextColor3 = Color3.new(1, 1, 1)
                    textLabel.Font = Enum.Font.SourceSansBold
                    textLabel.TextSize = 14
                    textLabel.Text = LABEL_TEXT
                    textLabel.Parent = billboard
                    
                    billboard.Parent = part
                end
            end

            -- Function to remove labels
            local function removeLabel(part)
                local label = part:FindFirstChild("LocationLabel")
                if label then
                    label:Destroy()
                end
            end

            -- Main update function
            local function updateLabels()
                if not espEnabled then return end  -- Stop if ESP is disabled
                
                local camera = workspace.CurrentCamera
                local playerPosition = camera.CFrame.Position
                local partCount = 0
                
                for _, model in ipairs(workspace:GetDescendants()) do
                    if model:IsA("BasePart") and model.Size == SEARCH_SIZE then
                        local distance = (model.Position - playerPosition).Magnitude
                        
                        if distance <= MAX_DISTANCE then
                            createLabel(model)
                        else
                            removeLabel(model)
                        end
                        
                        partCount = partCount + 1
                        if partCount >= BATCH_SIZE then
                            partCount = 0
                            wait()
                        end
                    end
                end
            end

            -- Set up the update loop
            spawn(function()
                while espEnabled do
                    updateLabels()
                    wait(REFRESH_RATE)
                end
            end)

        else
            -- Disable ESP
            espEnabled = false
            
            -- Remove all existing labels
            for _, v in pairs(workspace:GetDescendants()) do
                local label = v:FindFirstChild("LocationLabel")
                if label then
                    label:Destroy()
                end
            end
        end
    end    
})
